#!/bin/bash
#
# lview_import_publish
#
# Script to run on Linux system (not the Lview server) to scp subseasonal files generated by other means into
# LongView for the weeks and regions indicated and then cause LongView to publish the files
# to the CPG and the Verification system.
#
#  This script copies all the files it finds in the source directory.
#  This script leaves the files in the source directory, so the user has to clean up.
#  This script assumes the user has the access key.
#  This script quietly logs problems in the log file. The user should verify success.
#  This script assumes the files are named properly.
#       subseasonal_Tc_NA_Week5_20180612.txt
#       subseasonal_Tc_EUR_Week5_20180612.txt
#     

# The log directory is off the home directory of the user.
LOG_FILE=~/log/lview_import_publish_`date -u +%Y%m%d-%H`.log

echo "$0 started" >> ${LOG_FILE}

# The data files live in a directory off the home directory of the user.
SRC_DIR=~/subseasonal
SRC_EXT=txt

# The data files will land in the appropriate place on the LongView system
DEST_DIR=/longview/etc
DEST_SYS=longview-east-ldm-prod.wsi.com
#DEST_SYS=longview-west-ldm-prod.wsi.com
DEST_USR=centos

# Use the RadarPlus.pem key to access the LongView system. Send each file individually to log it.
for file in ${SRC_DIR}/subseas*.${SRC_EXT}; do
    echo "   Copying $file to ${DEST_SYS} at `date -u +%H%Mz` on `date -u +%a-%m/%d` " >> ${LOG_FILE}
    RESULT=`scp -i ~/.ssh/RadarPlus.pem $file ${DEST_USR}@${DEST_SYS}:${DEST_DIR}`

    if [ $RESULT > 0 ]; then
       echo "SCP of $file failed with error ${RESULT}" >> ${LOG_FILE}
    fi
done

echo "$0 finished" >> ${LOG_FILE}

